*[Назад](./../README.md)*  
  
### Задание для урока №6  
  
- [X] 1 Подключите работу с базой данных к приложению менеджера сбора метрик  
- [X] 2 Подключите клиента сервиса агента сбора метрик к остальным контроллерам менеджера сбора метрик  
- [X] 3 Для методов, возвращающих значение перцентилей на интервале посчитайте значение перцентилей по полученным метрикам воспользовавшись описанием того, что такое перцентиль из предыдущего урока  
- [X] 4 Напишите тесты на методы считающие перцентили, закрыв настоящий клиент объектом-заглушкой  
- [X] 5 Полученные метрики от сервис-агента при помощи написанного репозитория складывайте в базу данных  
  
---  
  
### Пояснения по выполнению задания  
  
В этом задании Менеджер метрик доведен до ума (ну почти) и полноценно работает:  
- собирает с зарегистрированных в базе агентов метрики по расписанию,  
- заносит их в свою базу  
- выдает наружу по запросу.  
  
Примеры HTTP запросов к Менеджеру метрик  
  
Запросы к контроллеру агентов.  
```css  
//Получить список всех зарегистрированных агентов:  
http://localhost:5000/api/agents/read  
  
//Регистрация агента (информация об агенте (ID, Url) идут в body запроса:  
http://localhost:5000/api/agents/register  
```  
  
Запросы к контроллеру CPU метрик:
```css  
//Запрос метрик определенного агента за период времени
http://localhost:5000/api/metrics/cpu/agent/1/from/2021-04-12/to/2021-04-15
//Запрос перцентиля определенного агента за период времени
http://localhost:5000/api/metrics/cpu/agent/1/from/2021-04-12/to/2021-04-15/percentiles/P90

//Запрос метрик для всех агентов за период времени
http://localhost:5000/api/metrics/cpu/cluster/from/2021-04-12/to/2021-04-15
//Запрос перцентилей для всех агентов за период времени
http://localhost:5000/api/metrics/cpu/cluster/from/2021-04-12/to/2021-04-15/percentiles/P90
```  
(запросы к остальным контроллерам строятся аналогично)  
  
---  
  
Запись метрик в базу сделал с использованием механизма транзакций, для ускорения (например в случае если агенты успели накопить много метрик)  
  
Все тесты к контроллерам сделаны с помощью моков репозиториев. Проверены и работают.  
  
